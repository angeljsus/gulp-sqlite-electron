"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var db=getDatabase();function select(o,t){var r,a,c,s,l,i="SELECT ",u=[],f={},p="",m=1;return new Promise(function(e,n){t&&(t.cols&&0<t.cols.length?i+=t.cols.replace(/,$/,""):i+="*",t.where?(s=getCondiciones(t,o)).error?n(s.error):(i+=" FROM ".concat(o," WHERE ").concat(s.complemento),f={consulta:i,valorVariables:s.valorVariables}):(i+=" FROM ".concat(o," "),f={consulta:i,valorVariables:[]}),e(f))}).then(function(o){return p=o.consulta,new Promise(function(e,n){m=1,t.group&&t.group.variables&&(p+="GROUP BY ",t.group.valores&&t.group.condiciones?(u=t.group.variables.replace(/,$/,"").split(","),a=t.group.condiciones.replace(/,$/,"").split(","),r=t.group.valores.replace(/__$/,"").split("__"),u.length==r.length&&u.length==a.length?u.forEach(function(e,n){p=(p+="".concat(u[n]," "))+"".concat(a[n]," "),l=_typeof(parseInt(r[n])),p+="number"==l?"".concat(r[n]):'"'.concat(r[n],'"'),m==u.length?p+="":p+=",",m++}):n("Faltan parametros en para agrupar con condicionales, deben ser la misma cantidad de variables\nvars: ".concat(u.length,"\ncondc:").concat(a.length,"\nvals:").concat(r.length,"\nseparacion: ___"))):p+=t.group.variables),t.order&&t.order.variables&&(p+=" ORDER BY ".concat(t.order.variables.replace(/,$/,"")),t.order.type&&(p+=" ".concat(t.order.type))),t.limit&&(t.limit.start||0==t.limit.start&&!1!==t.limit.start)&&(p+=" LIMIT ".concat(t.limit.start),t.limit.end&&(p+=", ".concat(t.limit.end))),p+=";",o.consulta=p,e(o)})}).then(function(t){return p=t.consulta,new Promise(function(o,n){db.transaction(function(e){e.executeSql(p,t.valorVariables,function(e,n){c=Object.keys(n.rows).map(function(e){return n.rows[e]}),o(c)})},function(e){n(e.message)})})})}function insert(e,o){var t=[],r="";return new Promise(function(e,n){o.cols?e(o.cols.replace(/__$/,"").split("__")):n("No hay columnas para insertar.\n")}).then(function(o){return r="INSERT INTO ".concat(e," VALUES ("),t=[],o.forEach(function(e){"null"==e?(r+="?,",t.push(null)):(r+="?,",t.push(e))}),r=r.replace(/,$/,""),r+=");",new Promise(function(e,n){db.transaction(function(e){e.executeSql(r,t)},function(e){n(e.message)},function(){e(o)})})})}function update(a,c){var s="",r="";return new Promise(function(e,n){s+="Faltan cosas:\n";var o=0,t=0,r=0;c.cols?t=c.cols.replace(/__$/,"").split("__"):(s+="cols: No hay valores para modificar\n",o++),c.colsNames?(r=c.colsNames.replace(/,$/,"").split(","),t.length!==r.length&&(s+="Los parametros no tienen las mismas cantidades:\ncols: ".concat(t.length,"\ncolsNames: ").concat(r.length),o++)):(s+="colsNames: No hay nombre de columnas\n",o++),0<o?n(s):e(c.where?{valores:t,columnas:r,condicion:getCondiciones(c,a)}:{valores:t,columnas:r,condicion:""})}).then(function(t){return new Promise(function(e,n){var o;t.condicion.error?n(t.condicion.error):(r="UPDATE ".concat(a," SET "),t.columnas.forEach(function(e,n){r+=(0==n?"":", ").concat(e," = ?")}),n=t.valores,o=[],t.valores.forEach(function(e){o.push(e)}),t.condicion.complemento&&(r+=" WHERE "+t.condicion.complemento,t.condicion.valorVariables.forEach(function(e){o.push(e)})),e({consulta:r+=";",valores:o,dataReturn:n}))})}).then(function(t){return new Promise(function(o,n){db.transaction(function(e){e.executeSql(r,t.valores,function(e,n){o(n.rowsAffected)})},function(e){n(e.message)},function(){})})})}function deleteReg(o,t){var r,a={consulta:"",valores:[]},c="";return new Promise(function(e,n){c+="DELETE FROM ".concat(o," "),t.where&&((r=getCondiciones(t,o)).error?n(r.error):r.complemento&&(c+="WHERE ".concat(r.complemento),a.valores=r.valorVariables)),a.consulta=c,e(a)}).then(function(t){return new Promise(function(o,n){db.transaction(function(e){e.executeSql(c,t.valores,function(e,n){o(n.rowsAffected)})},function(e){n(e.message)},function(){})})})}function getCondiciones(e,n){var o="",t="",r="",a=1,c=[],s=[],l=[];return e.where.variables&&e.where.valores?(c=e.where.variables.replace(/,$/,"").split(","),s=(s=e.where.valores.toString()).replace(/__$/,"").split("__"),e.where.condiciones&&(l=e.where.condiciones.split(","),t=!0),c.forEach(function(e,n){!s[n]&&s[n]<0&&(r="La cantidad de valores no corresponde a las variables enviadas, vars: ".concat(c.length," vals: ").concat(s.length)),o+=e+" ",0<t&&l[n]?o+="".concat(l[n]," "):o+="= ",o+="? ",c.length>a&&(o+="AND "),a++}),c.length==s.length||(r="La cantidad de valores no corresponde a las variables enviadas, object.where.valores: ".concat(c.length," object.where.variables: ").concat(s.length)),{complemento:o,error:r,valorVariables:s}):{error:r=e.where.variables||e.where.valores?"No existe variable o valor de object.where.valores o object.where.variables":""}}module.exports={select:select,insert:insert,update:update,deleteReg:deleteReg};
